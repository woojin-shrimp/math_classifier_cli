# math_classifier_cli
---

# 📄 인공지능 기반 수학 문항 자동 분류기 (Gemini CLI 버전)

Google Gemini CLI를 사용하여 PDF 형식의 수학 시험지를 자동 분석하고, 각 문항을 교과 내용과 역량에 따라 분류한 뒤 결과를 CSV 형식으로 저장합니다.  
분류틀은 **「2015 개정 수학과 교육과정의 수학 교과 역량을 반영한 국가수준 학업성취도 평가의 평가틀 및 예시 문항 개발」(임해미, 김성경, 박지현, 2018)** 논문을 참고하였습니다.

---

## 📌 프로젝트 소개

### 동기
이 프로젝트는 수학 문제 추천 서비스에서 **문제의 질과 문제 추천의 질**을 평가하고 개선하기 위한 기초 데이터를 제공할 목적으로 시작되었습니다.  
PDF에 담긴 시험지 내용을 AI가 직접 분석하여 구조화된 CSV로 저장할 수 있도록 설계되었습니다.

### 활용 방안
- **시험 출제 경향 분석**  
  기출문제 분석을 통해 자주 출제되는 개념·유형 파악 및 시험 대비 전략 수립
- **신규 문항 개발 지원**  
  기존 문항의 유형·난이도 분포 분석을 기반으로 균형 잡힌 신규 문항 제작
- **문항 추천 서비스 데이터베이스 구축**  
  학생의 취약점 분석 및 유사 유형 문제 추천

---

## ⚙️ 사전 준비

### 1. 요구 사항
- macOS 또는 Linux
- Python 3.8 이상
- Google Gemini CLI 설치 및 OAuth 로그인

### 2. Gemini CLI 설치
```bash
# 셋 중 하나를 선택해 설치
npm install -g @google/gemini-cli
# 또는
brew install gemini-cli
# 또는 (일회성 실행)
npx @google/gemini-cli
````

### 3. Gemini CLI 로그인 (OAuth)

```bash
gemini
```

* 브라우저가 열리면 Google 계정으로 로그인 후 권한 승인
* 로그인은 한 번만 하면 되고, 이후에는 캐시된 자격 증명을 사용

> 💡 CLI는 현재 작업 폴더 주변을 스캔하므로, 반드시 **작은 전용 폴더**에서 실행하세요.

### 4. Python 패키지 설치

```bash
pip install PyMuPDF
```

---

## 📂 디렉터리 구조

```
pdf_automation/
├── source_pdfs/           # 분석할 PDF 파일 저장
├── results/               # 분석 결과 CSV 저장
├── prompts/               # AI 프롬프트 정책/분류 기준 파일
│   ├── policy.txt
│   └── schema.txt
├── extract_text.py        # PDF → 텍스트 추출 스크립트
└── gemini_auto_script.sh  # 전체 자동화 실행 스크립트
```

---

## 📝 프롬프트 파일 작성

### prompts/policy.txt

```
당신은 오직 CSV 데이터만 생성하는 AI입니다.
헤더 없이 `번호,교과내용,교과역량` 형식만 출력하세요.
설명, 인사, 사과 등 다른 말은 절대 출력하지 마세요.
```

### prompts/schema.txt

```
# 분류 기준

1.  **교과내용**: (문제에 해당하는 가장 구체적인 개념 하나를 선택)
    지수와 로그, 지수함수와 로그함수, 삼각함수, 등차수열과 등비수열, 수열의 합, 수학적 귀납법,
    함수의 극한, 함수의 연속, 미분계수, 도함수, 도함수의 활용, 부정적분, 정적분, 정적분의 활용,
    미적분**: 수열의 극한, 급수, 여러 가지 함수의 미분, 여러 가지 미분법, 도함수의 활용, 여러 가지 적분법, 정적분의 활용,
    순열과 조합, 이항정리, 확률의 뜻과 활용, 조건부확률, 확률분포, 통계적 추정,
    이차곡선, 벡터의 연산, 평면벡터의 성분과 내적, 직선과 평면, 정사영, 공간좌표

2.  **교과역량**: (문제 해결에 사용된 가장 핵심적인 역량을 선택)
    계산, 이해,
    연역추론, 발견추론,
    내적 문제해결, 외적 문제해결, 다양한 전략 활용,
    정보 수집 및 정리, 정보 분석 및 활용, 공학적 도구 및 교구 활용

교과역량 및 하위 요소 정의
계산: 계산 방법 및 절차 구사 능력
이해: 개념, 원리, 법칙 파악 및 개념적 사고 형성 능력
발견추론: 관찰, 귀납, 유추를 통해 수학적 사실과 해결 방법 발견 능력
연역추론: 논리적으로 수학적 절차와 사실을 도출하고 명제를 정당화하는 능력
내적 문제해결: 수학 내의 개념과 원리 간 관련성을 창의적으로 파악하고 해결하는 능력
외적 문제해결: 실생활 및 타 교과와의 융합적 문제 상황을 수학적으로 분석하고 결론을 도출하는 능력
다양한 전략 활용: 문제를 다양하게 변형하거나 새로운 문제를 만들고 효과적인 해결 방법을 찾는 능력
정보 수집 및 정리: 자료나 정보를 목적에 맞게 분류하고 정리하는 능력
정보 분석 및 활용: 자료의 의미를 정확히 분석하고 해석하여 활용하는 능력
공학적 도구 및 교구 활용: 공학적 도구나 교구를 활용하여 수학적 탐구 및 문제 해결을 수행하는 능력
```

---

## 🚀 사용법

1. **PDF 준비**
   분석할 시험지 PDF를 `source_pdfs/` 폴더에 넣습니다.

2. **실행 권한 부여**

```bash
chmod +x gemini_auto_script.sh
```

3. **스크립트 실행**

```bash
./gemini_auto_script.sh <반복횟수>
```

예:

```bash
./gemini_auto_script.sh 3
```

* `<반복횟수>`: PDF 한 파일을 몇 번 반복 분석할지 설정
* 결과 CSV는 `results/` 폴더에 저장

---

## 📊 결과물 예시

결과 파일: `results/파일명_analysis.csv`

```
번호,교과내용,교과역량,분석회차
1,지수와 로그,계산,1
2,함수의 극한,이해,1
...
```

---

## ⚡ 환경 변수 옵션

| 변수           | 설명                       | 기본값            |
| ------------ | ------------------------ | -------------- |
| `MODEL`      | 사용할 모델명                  | gemini-2.5-pro |
| `USE_CHUNK`  | 긴 텍스트를 청크로 나눌지 여부 (1=사용) | 0              |
| `MAX_CHARS`  | 청크당 최대 문자 수              | 180000         |
| `RATE_SLEEP` | 호출 간 대기 시간(초)            | 1.2            |

---

## 🛠 문제 해결

* **`Loaded cached credentials.` 메시지 숨기기**
  → `2>/dev/null` 또는 `grep -v 'Loaded cached credentials.'` 필터 사용
* **`Error when talking to Gemini API`**
  → PDF가 너무 크면 `USE_CHUNK=1`로 설정 후 `MAX_CHARS`를 줄여서 실행
